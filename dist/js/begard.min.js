(function(){var e;e=function(e){var a={options:{remote:"",method:"POST",multiSelect:!1,defaultErrorMessage:"An error occurred",templates:{directory:'<div class="begard-directory" data-path="{data-path}" data-index="{data-index}"><a href="javascript:void(0)"><ul><li class="icon"><i class="fa fa-folder"></i></li><li>{data-name}</li></ul></a></div>',file:'<div class="begard-file" data-path="{data-path}" data-index="{data-index}"><ul><li class="icon"><i class="fa {data-extension}-ext"></i></li><li>{data-name}</li></ul></div>',breadcrumb:'<li class="begard-crumb"><a href="#" class="begard-crumb-to" data-path="{data-path}">{data-name}</a></li>',fileDetails:"<h4>Selected file details</h4><ul><li>Name: {data-name}</li><li>Extension: {data-extension}</li><li>Size: {data-size}</li></ul>",uploadList:'<div class="begard-upload-item" data-id="{data-id}"><ul><i class="begard-upload-close fa fa-times disabled"></i><li class="begard-upload-error disabled">An error occurred.</li><li class="begard-upload-name">{data-name}</li><li><div class="progress"><div class="progress-bar progress-bar-warning" role="progressbar" data-change-percent-width data-change-percent-text aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div></div></li></ul></div>'}},data:[],currentPath:"",currentOperation:null,lastFileId:0,willOperate:[],init:function(){a.handleEvents(),a.openDirectory("/"),a.disableOperations(),e("#begard-error").addClass("disabled")},handleEvents:function(){e(document).on("dblclick",".begard-directory",function(t){a.openDirectoryEvent(t,e(this))}),e(document).on("click",".begard-crumb-to",function(t){a.openCrumbDirectoryEvent(t,e(this))}),e(document).on("click","#begard-need-refresh",function(t){a.needRefreshEvent(t,e(this))}),e(document).on("click",".begard-directory",function(t){a.selectDirectoryEvent(t,e(this))}),e(document).on("click",".begard-file",function(t){a.selectFileEvent(t,e(this))}),e(document).on("click","#begard-up",function(t){a.upDirectoryEvent(t,e(this))}),e(document).on("click",".begard-upload-close",function(t){a.uploadCloseEvent(t,e(this))}),e(document).on("change","#begard-upload-input",function(t){a.uploadInputChangeEvent(t,e(this))}),e(document).on("click","#begard-error-close",function(t){a.closeErrorEvent(t,e(this))}),e(document).on("click","#begard-operation-rename-link",function(t){a.renameEvent(t,e(this))}),e(document).on("click","#begard-operation-rename-cancel",function(t){a.renameCancelEvent(t,e(this))}),e(document).on("click","#begard-operation-rename-go",function(t){a.renameGoEvent(t,e(this))}),e(document).on("click","#begard-operation-delete-link",function(t){a.deleteEvent(t,e(this))}),e(document).on("click","#begard-operation-delete-cancel",function(t){a.deleteCancelEvent(t,e(this))}),e(document).on("click","#begard-operation-delete-go",function(t){a.deleteGoEvent(t,e(this))}),e(document).on("click","#begard-operation-copy-link",function(t){a.copyEvent(t,e(this))}),e(document).on("click","#begard-operation-move-link",function(t){a.moveEvent(t,e(this))}),e(document).on("click","#begard-operation-paste-cancel",function(t){a.pasteCancelEvent(t,e(this))}),e(document).on("click","#begard-operation-paste-go",function(t){a.pasteGoEvent(t,e(this))})},getData:function(t){e.ajax({url:a.options.remote,data:{path:t,requestType:"info"},method:a.options.method,dataType:"json",cache:!1}).done(function(e){var t=e.path;delete e.path,a.data[t]=e,a.refreshVars(t),a.refreshView(t)})},refreshVars:function(e){a.currentPath=e},refreshView:function(t){a.refreshDirectories(t),a.refreshFiles(t),a.checkUpDirectory(t),a.refreshBreadcrumb(),null===a.currentOperation?a.disableOperations():a.updateOperations(),e("#begard-need-refresh").addClass("disabled"),e("#begard-file-details").addClass("disabled")},selectDirectoryEvent:function(e,t){a.select(e,t,"directory")},selectFileEvent:function(e,t){a.select(e,t,"file")},select:function(e,t,r){t.hasClass("begard-selected")?t.removeClass("begard-selected"):a.options.multiSelect?t.addClass("begard-selected"):(a.unSelectEveryThing(),t.addClass("begard-selected")),a.refreshFileDetails(),a.refreshOperations()},refreshOperations:function(){var t=e("#begard-files .begard-selected"),r=e("#begard-directories .begard-selected");null===a.currentOperation&&(0===t.length&&0===r.length?e("#begard-operations").addClass("disabled"):(e("#begard-operations").removeClass("disabled"),e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-rename").addClass("disabled"),e("#begard-operation-delete").addClass("disabled"),1===t.length&&0===r.length||0===t.length&&1===r.length?e("#begard-operation-rename-link").removeClass("disabled"):e("#begard-operation-rename-link").addClass("disabled"),(t.length>0||r.length>0)&&(e("#begard-operation-copy-link").removeClass("disabled"),e("#begard-operation-move-link").removeClass("disabled"),e("#begard-operation-delete-link").removeClass("disabled"),e("#begard-operation-cut-link").removeClass("disabled"))))},updateOperations:function(){("copy"===a.currentOperation||"move"===a.currentOperation)&&(a.willOperate.path!==a.currentPath?e("#begard-operation-paste-go").removeClass("disabled").removeAttr("disabled"):e("#begard-operation-paste-go").addClass("disabled").addAttr("disabled"))},refreshFileDetails:function(){var t=e("#begard-directories .begard-selected"),r=e("#begard-files .begard-selected");if(0===t.length&&1===r.length){e("#begard-file-details").children().remove();var d=e("#begard-files .begard-selected"),n=d.attr("data-path"),i=d.attr("data-index"),o=a.data[n].files[i],s=a.options.templates.fileDetails;s=s.replace(new RegExp("{data-name}","g"),o.name),s=s.replace(new RegExp("{data-size}","g"),o.size),s=s.replace(new RegExp("{data-extension}","g"),o.extension),e("#begard-file-details").append(s),e("#begard-file-details").removeClass("disabled")}else e("#begard-file-details").addClass("disabled")},disableOperations:function(){e("#begard-operations").addClass("disabled"),e("#begard-operation-copy-link").addClass("disabled"),e("#begard-operation-rename-link").addClass("disabled"),e("#begard-operation-move-link").addClass("disabled"),e("#begard-operation-delete-link").addClass("disabled"),e("#begard-operation-rename").addClass("disabled"),e("#begard-operation-delete").addClass("disabled"),e("#begard-operation-paste").addClass("disabled")},openDirectory:function(e){"undefined"!=typeof a.data[e]?(a.refreshVars(e),a.refreshView(e)):a.getData(e)},openDirectoryEvent:function(e,t){var r=t.attr("data-path"),d=t.attr("data-index");a.openDirectory(a.createDirectoryPath(r,d))},openCrumbDirectoryEvent:function(e,t){var r=t.attr("data-path");a.openDirectory(r)},createDirectoryPath:function(e,t){var r=a.data[e].directories[t];return basePath="/"!==e?e+"/"+r:e+r,basePath},needRefreshEvent:function(e,t){var r=t.attr("data-path");t.addClass("disabled"),a.openDirectory(r)},upDirectoryEvent:function(e,t){"/"!==a.currentPath&&(lastIndexSlash=a.currentPath.lastIndexOf("/"),upPath=a.currentPath.substr(0,lastIndexSlash),""===upPath&&(upPath="/"),a.openDirectory(upPath))},unSelectEveryThing:function(){e("#begard-files .begard-selected").removeClass("begard-selected"),e("#begard-directories .begard-selected").removeClass("begard-selected")},checkUpDirectory:function(t){"/"===a.currentPath?e("#begard-up").attr("disabled","disabled").addClass("disabled"):e("#begard-up").removeAttr("disabled").removeClass("disabled")},refreshFiles:function(t){e("#begard-files .begard-file").remove(),e.each(a.data[t].files,function(r,d){var n=a.options.templates.file;n=n.replace(new RegExp("{data-name}","g"),d.name),n=n.replace(new RegExp("{data-size}","g"),d.size),n=n.replace(new RegExp("{data-path}","g"),t),n=n.replace(new RegExp("{data-index}","g"),r),n=n.replace(new RegExp("{data-extension}","g"),d.extension),e("#begard-files").append(n)})},refreshDirectories:function(t){e("#begard-directories .begard-directory").remove(),e.each(a.data[t].directories,function(r,d){var n=a.options.templates.directory;n=n.replace(new RegExp("{data-path}","g"),t),n=n.replace(new RegExp("{data-name}","g"),d),n=n.replace(new RegExp("{data-index}","g"),r),e("#begard-directories").append(n)})},refreshBreadcrumb:function(){var t=a.currentPath.split("/"),r=[];e.each(t,function(e,a){""!==a&&r.push(a)}),e("#begard-breadcrumb .begard-crumb").remove();var d="/",n=a.options.templates.breadcrumb;n=n.replace(new RegExp("{data-name}","g"),"/"),n=n.replace(new RegExp("{data-path}","g"),d),e("#begard-breadcrumb").append(n),e.each(r,function(t,r){d+=r;var n=a.options.templates.breadcrumb;n=n.replace(new RegExp("{data-name}","g"),r),n=n.replace(new RegExp("{data-path}","g"),d),e("#begard-breadcrumb").append(n),d+="/"}),e("#begard-breadcrumb .begard-crumb").last().addClass("active")},uploadInputChangeEvent:function(e,t){var r=e.target.files[0];r.percent=0,r.id=++a.lastFileId,a.upload(r)},upload:function(t){a.createUploadItem(t);var r=new FormData;r.append("file",t),r.append("path",a.currentPath),r.append("requestType","upload"),e("#begard-upload-form")[0].reset();e.ajax({url:a.options.remote,method:a.options.method,data:r,cache:!1,dataType:"json",processData:!1,contentType:!1,cache:!1,xhr:function(){var r=e.ajaxSettings.xhr();return r.upload&&r.upload.addEventListener("progress",function(e){var r=0,d=e.loaded||e.position,n=e.total;e.lengthComputable&&(r=Math.ceil(d/n*100)),t.percent=r,a.refreshUploadItem(t)},!1),r}}).done(function(r){if(1!==r.status)a.failedUploadItem(t);else{var d=e('.begard-upload-item[data-id="'+t.id+'"]');d.addClass("begard-upload-item-succeed"),a.needRefresh(r.path)}}).fail(function(e,r){a.failedUploadItem(t)}).complete(function(){var a=e('.begard-upload-item[data-id="'+t.id+'"]');a.find(".begard-upload-close").removeClass("disabled")})},failedUploadItem:function(a){var t=e('.begard-upload-item[data-id="'+a.id+'"]');t.addClass("begard-upload-item-failed").find(".begard-upload-error").removeClass("disabled")},createUploadItem:function(t){e('.begard-upload-item[data-id="'+t.id+'"]').remove();var r=a.options.templates.uploadList;r=r.replace(new RegExp("{data-id}","g"),t.id),r=r.replace(new RegExp("{data-percent}","g"),t.percent),r=r.replace(new RegExp("{data-name}","g"),t.name),e("#begard-upload-list").append(r)},refreshUploadItem:function(a){var t=e('.begard-upload-item[data-id="'+a.id+'"]');t.find("[data-change-percent-width]").css({width:a.percent+"%"}),t.find("[data-change-percent-text]").text(a.percent+"%")},uploadCloseEvent:function(e,a){a.closest(".begard-upload-item").remove()},renameEvent:function(t,r){a.currentOperation="rename",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-rename").removeClass("disabled");var d=e("#begard-files .begard-selected"),n=e("#begard-directories .begard-selected");if(a.willOperate={requestType:"operation",operation:"rename"},1===d.length){var i=d.attr("data-path");a.willOperate.type="file",a.willOperate.path=i,a.willOperate.name=a.data[i].files[d.attr("data-index")].name}else{var i=n.attr("data-path");a.willOperate.type="directory",a.willOperate.path=i,a.willOperate.name=a.data[i].directories[n.attr("data-index")]}},renameGoEvent:function(t,r){a.willOperate.renameTo=e("#begard-operation-rename-input").val(),e.ajax({url:a.options.remote,data:a.willOperate,method:a.options.method,dataType:"json",cache:!1}).done(function(e){1!==e.status?a.showError(e.message):a.needRefresh(e.path)}).fail(function(){a.showError(a.options.defaultErrorMessage)}).complete(function(){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-rename").addClass("disabled"),a.currentOperation=null})},renameCancelEvent:function(t,r){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-rename").addClass("disabled"),a.currentOperation=null},deleteEvent:function(t,r){a.currentOperation="delete",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-delete").removeClass("disabled");var d=e("#begard-files .begard-selected"),n=e("#begard-directories .begard-selected");a.willOperate={requestType:"operation",operation:"delete",path:a.currentPath,files:[],directories:[]},d.each(function(){var t=e(this).attr("data-path");a.willOperate.files.push(a.data[t].files[e(this).attr("data-index")].name)}),n.each(function(){var t=e(this).attr("data-path");a.willOperate.directories.push(a.data[t].directories[e(this).attr("data-index")])})},deleteGoEvent:function(t,r){e.ajax({url:a.options.remote,data:a.willOperate,method:a.options.method,dataType:"json",cache:!1}).done(function(e){1!==e.status?a.showError(e.message):a.needRefresh(e.path)}).fail(function(){a.showError(a.options.defaultErrorMessage)}).complete(function(){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-delete").addClass("disabled"),a.currentOperation=null})},deleteCancelEvent:function(t,r){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-delete").addClass("disabled"),a.currentOperation=null},copyEvent:function(t,r){a.currentOperation="copy",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-paste").removeClass("disabled"),e("#begard-operation-paste-go").addClass("disabled").attr("disabled");var d=e("#begard-files .begard-selected"),n=e("#begard-directories .begard-selected");a.willOperate={requestType:"operation",operation:"copy",path:a.currentPath,files:[],directories:[]},d.each(function(){var t=e(this).attr("data-path");a.willOperate.files.push(a.data[t].files[e(this).attr("data-index")].name)}),n.each(function(){var t=e(this).attr("data-path");a.willOperate.directories.push(a.data[t].directories[e(this).attr("data-index")])})},moveEvent:function(t,r){a.currentOperation="move",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-paste").removeClass("disabled"),e("#begard-operation-paste-go").addClass("disabled").attr("disabled");var d=e("#begard-files .begard-selected"),n=e("#begard-directories .begard-selected");a.willOperate={requestType:"operation",operation:"move",path:a.currentPath,files:[],directories:[]},d.each(function(){var t=e(this).attr("data-path");a.willOperate.files.push(a.data[t].files[e(this).attr("data-index")].name)}),n.each(function(){var t=e(this).attr("data-path");a.willOperate.directories.push(a.data[t].directories[e(this).attr("data-index")])})},pasteCancelEvent:function(t,r){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-paste").addClass("disabled"),e("#begard-operation-paste-go").removeClass("disabled").removeAttr("disabled"),a.currentOperation=null},pasteGoEvent:function(t,r){a.willOperate.pathTo=a.currentPath,e.ajax({url:a.options.remote,data:a.willOperate,method:a.options.method,dataType:"json",cache:!1}).done(function(e){1!==e.status?a.showError(e.message):(a.needRefresh(e.path),a.needRefresh(e.pathTo))}).fail(function(){a.showError(a.options.defaultErrorMessage)}).complete(function(){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-paste").addClass("disabled"),a.currentOperation=null})},needRefresh:function(t){delete a.data[t],t===a.currentPath&&e("#begard-need-refresh").attr("data-path",a.currentPath).removeClass("disabled")},showError:function(a){e("#begard-error").removeClass("disabled"),e("#begard-error-text").text(a)},closeErrorEvent:function(a,t){e("#begard-error").addClass("disabled")}};return begard={config:function(t){e.extend(!0,a.options,t)},standalone:function(){a.init(),e("#begard-close").addClass("disabled"),e("#begard").addClass("begard-standalone").removeClass("begard-modal")},modal:function(){a.init(),e("#begard").addClass("begard-modal").removeClass("begard-standalone")},close:function(){}}},"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):window.begard=e(window.jQuery)}).call(this);