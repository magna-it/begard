(function(){var e;e=function(e){var a={options:{remote:"",method:"POST",multiSelect:!1,defaultErrorMessage:"An error occurred",autoRefresh:!1,templates:{directory:'<div class="begard-directory" data-path="{data-path}" data-index="{data-index}"><a href="javascript:void(0)"><ul><li class="icon"><i class="fa fa-folder"></i></li><li>{data-name}</li></ul></a></div>',file:'<div class="begard-file" data-path="{data-path}" data-index="{data-index}"><ul><li class="icon"><i class="fa {data-extension}-ext"></i></li><li class="begard-file-image" class="disabled"><div class="centered"><img class="begard-file-image-src" src=""></div></li><li>{data-name}</li></ul></div>',fileDetails:'<h4>Selected file details</h4><ul><li class="begard-file-details-image"><img class="begard-file-details-image-src" src=""></li><li>Name: {data-name}</li><li>Extension: {data-extension}</li><li>Size: {data-size}</li></ul>',breadcrumb:'<li class="begard-crumb"><a href="#" class="begard-crumb-to" data-path="{data-path}">{data-name}</a></li>',uploadList:'<div class="begard-upload-item" data-id="{data-id}"><ul><i class="begard-upload-close fa fa-times disabled"></i><li class="begard-upload-error disabled"></li><li class="begard-upload-name">{data-name}</li><li><div class="progress"><div class="progress-bar progress-bar-warning" role="progressbar" data-change-percent-width data-change-percent-text aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div></div></li></ul></div>'},sendWith:{all:{},info:{},copy:{},move:{},"delete":{},rename:{}},selectRules:{select:!0,fileSelect:!0,fileAcceptedMimes:"all",directorySelect:!1}},modalEvents:{afterSelect:null},data:[],currentPath:"",currentOperation:null,lastFileId:0,willOperate:[],isModal:!1,init:function(t){a.isModal=t,a.openDirectory("/"),e.isArray(a.options.selectRules.fileAcceptedMimes)&&-1!==e.inArray("images",a.options.selectRules.fileAcceptedMimes)&&(index=e.inArray("images",a.options.selectRules.fileAcceptedMimes),a.options.selectRules.fileAcceptedMimes[index]="image/jpeg",a.options.selectRules.fileAcceptedMimes.push("image/bmp"),a.options.selectRules.fileAcceptedMimes.push("image/png")),a.disableOperations(),e("#begard-error").addClass("disabled")},handleEvents:function(){e(document).on("dblclick",".begard-directory",function(t){a.openDirectoryEvent(t,e(this))}),e(document).on("click",".begard-crumb-to",function(t){a.openCrumbDirectoryEvent(t,e(this))}),e(document).on("click","#begard-need-refresh",function(t){a.needRefreshEvent(t,e(this))}),e(document).on("click",".begard-directory",function(t){a.selectDirectoryEvent(t,e(this))}),e(document).on("click",".begard-file",function(t){a.selectFileEvent(t,e(this))}),e(document).on("click","#begard-up",function(t){a.upDirectoryEvent(t,e(this))}),e(document).on("click",".begard-upload-close",function(t){a.uploadCloseEvent(t,e(this))}),e(document).on("change","#begard-upload-input",function(t){a.uploadInputChangeEvent(t,e(this))}),e(document).on("click","#begard-error-close",function(t){a.closeErrorEvent(t,e(this))}),e(document).on("click","#begard-close",function(e){a.closeBegard()}),e(document).on("click","#begard-select-link",function(t){a.selectEvent(t,e(this))}),e(document).on("click","#begard-operation-rename-link",function(t){a.renameEvent(t,e(this))}),e(document).on("click","#begard-operation-rename-cancel",function(t){a.renameCancelEvent(t,e(this))}),e(document).on("click","#begard-operation-rename-go",function(t){a.renameGoEvent(t,e(this))}),e(document).on("click","#begard-operation-delete-link",function(t){a.deleteEvent(t,e(this))}),e(document).on("click","#begard-operation-delete-cancel",function(t){a.deleteCancelEvent(t,e(this))}),e(document).on("click","#begard-operation-delete-go",function(t){a.deleteGoEvent(t,e(this))}),e(document).on("click","#begard-operation-copy-link",function(t){a.copyEvent(t,e(this))}),e(document).on("click","#begard-operation-move-link",function(t){a.moveEvent(t,e(this))}),e(document).on("click","#begard-operation-paste-cancel",function(t){a.pasteCancelEvent(t,e(this))}),e(document).on("click","#begard-operation-paste-go",function(t){a.pasteGoEvent(t,e(this))})},getInfo:function(t){e.ajax({url:a.options.remote,data:{path:t,requestType:"info",extra:e.extend(!0,{},a.options.sendWith.info,a.options.sendWith.all)},method:a.options.method,dataType:"json",cache:!1}).done(function(e){if(1!==e.status)a.showError(a.message);else{var t=e.path;delete e.path,a.data[t]=e,a.refreshVars(t),a.refreshView(t)}}).fail(function(){a.showError(a.options.defaultErrorMessage)})},refreshVars:function(e){a.currentPath=e},refreshView:function(t){a.refreshDirectories(t),a.refreshFiles(t),a.checkUpDirectory(t),a.refreshBreadcrumb(),null===a.currentOperation?a.disableOperations():a.updateOperations(),e("#begard-need-refresh").addClass("disabled"),e("#begard-file-details").addClass("disabled")},selectDirectoryEvent:function(e,t){a.select(e,t,"directory")},selectFileEvent:function(e,t){a.select(e,t,"file")},select:function(e,t,d){t.hasClass("begard-selected")?t.removeClass("begard-selected"):a.options.multiSelect?t.addClass("begard-selected"):(a.unSelectEveryThing(),t.addClass("begard-selected")),a.refreshFileDetails(),a.refreshOperations(),a.refreshModalView()},refreshModalView:function(){var t=e("#begard-files .begard-selected"),d=e("#begard-directories .begard-selected");a.isModal&&a.options.selectRules.select&&(t.length>0||d.length>0?e("#begard-select-link").removeClass("disabled").removeAttr("disabled"):e("#begard-select-link").addClass("disabled").attr("disabled"),a.options.selectRules.fileSelect?t.length>0&&"all"!==a.options.selectRules.fileAcceptedMimes&&e.isArray(a.options.selectRules.fileAcceptedMimes)&&e.each(t,function(t,d){var r=e(this).attr("data-index"),i=e(this).attr("data-path"),d=a.data[i].files[r];return-1===e.inArray(d.mime,a.options.selectRules.fileAcceptedMimes)?(e("#begard-select-link").addClass("disabled").attr("disabled"),!1):void 0}):t.length>0&&e("#begard-select-link").addClass("disabled").attr("disabled"),d.length>0&&!a.options.selectRules.directorySelect&&e("#begard-select-link").addClass("disabled").attr("disabled"))},refreshOperations:function(){var t=e("#begard-files .begard-selected"),d=e("#begard-directories .begard-selected");null===a.currentOperation&&(0===t.length&&0===d.length?e("#begard-operations").addClass("disabled"):(e("#begard-operations").removeClass("disabled"),e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-rename").addClass("disabled"),e("#begard-operation-delete").addClass("disabled"),1===t.length&&0===d.length||0===t.length&&1===d.length?e("#begard-operation-rename-link").removeClass("disabled"):e("#begard-operation-rename-link").addClass("disabled"),(t.length>0||d.length>0)&&(e("#begard-operation-copy-link").removeClass("disabled"),e("#begard-operation-move-link").removeClass("disabled"),e("#begard-operation-delete-link").removeClass("disabled"),e("#begard-operation-cut-link").removeClass("disabled"))))},updateOperations:function(){("copy"===a.currentOperation||"move"===a.currentOperation)&&(a.willOperate.path!==a.currentPath?e("#begard-operation-paste-go").removeClass("disabled").removeAttr("disabled"):e("#begard-operation-paste-go").addClass("disabled").addAttr("disabled"))},refreshFileDetails:function(){var t=e("#begard-directories .begard-selected"),d=e("#begard-files .begard-selected");if(0===t.length&&1===d.length){e("#begard-file-details").children().remove();var r=e("#begard-files .begard-selected"),i=r.attr("data-path"),s=r.attr("data-index"),l=a.data[i].files[s],n=a.options.templates.fileDetails;e.each(l,function(e,a){n=n.replace(new RegExp("{data-"+e+"}","g"),a)}),l.hasOwnProperty("preview")&&(n=e(n).addClass("begard-file-details-has-image").find(".begard-file-details-image").removeClass("disabled").find(".begard-file-details-image-src").attr("src",l.preview).closest(".begard-file-details-has-image")),e("#begard-file-details").append(n),e("#begard-file-details").removeClass("disabled")}else e("#begard-file-details").addClass("disabled")},disableOperations:function(){e("#begard-operations").addClass("disabled"),e("#begard-operation-copy-link").addClass("disabled"),e("#begard-operation-rename-link").addClass("disabled"),e("#begard-operation-move-link").addClass("disabled"),e("#begard-operation-delete-link").addClass("disabled"),e("#begard-operation-rename").addClass("disabled"),e("#begard-operation-delete").addClass("disabled"),e("#begard-operation-paste").addClass("disabled")},openDirectory:function(e){"undefined"!=typeof a.data[e]?(a.refreshVars(e),a.refreshView(e)):a.getInfo(e)},openDirectoryEvent:function(e,t){var d=t.attr("data-path"),r=t.attr("data-index");a.openDirectory(a.createDirectoryPath(d,r))},openCrumbDirectoryEvent:function(e,t){var d=t.attr("data-path");a.openDirectory(d)},createDirectoryPath:function(e,t){var d=a.data[e].directories[t];return basePath="/"!==e?e+"/"+d:e+d,basePath},needRefreshEvent:function(e,t){var d=t.attr("data-path");t.addClass("disabled"),a.openDirectory(d)},upDirectoryEvent:function(e,t){"/"!==a.currentPath&&(lastIndexSlash=a.currentPath.lastIndexOf("/"),upPath=a.currentPath.substr(0,lastIndexSlash),""===upPath&&(upPath="/"),a.openDirectory(upPath))},unSelectEveryThing:function(){e("#begard-files .begard-selected").removeClass("begard-selected"),e("#begard-directories .begard-selected").removeClass("begard-selected")},checkUpDirectory:function(t){"/"===a.currentPath?e("#begard-up").attr("disabled","disabled").addClass("disabled"):e("#begard-up").removeAttr("disabled").removeClass("disabled")},refreshFiles:function(t){e("#begard-files .begard-file").remove(),e.each(a.data[t].files,function(d,r){var i=a.options.templates.file;i=i.replace(new RegExp("{data-path}","g"),t),i=i.replace(new RegExp("{data-index}","g"),d),e.each(r,function(e,a){i=i.replace(new RegExp("{data-"+e+"}","g"),a)}),r.hasOwnProperty("preview")&&(i=e(i).addClass("begard-file-has-image").find(".begard-file-image").removeClass("disabled").find(".begard-file-image-src").attr("src",r.preview).closest(".begard-file-has-image")),e("#begard-files").append(i)})},refreshDirectories:function(t){e("#begard-directories .begard-directory").remove(),e.each(a.data[t].directories,function(d,r){var i=a.options.templates.directory;i=i.replace(new RegExp("{data-path}","g"),t),i=i.replace(new RegExp("{data-name}","g"),r),i=i.replace(new RegExp("{data-index}","g"),d),e("#begard-directories").append(i)})},refreshBreadcrumb:function(){var t=a.currentPath.split("/"),d=[];e.each(t,function(e,a){""!==a&&d.push(a)}),e("#begard-breadcrumb .begard-crumb").remove();var r="/",i=a.options.templates.breadcrumb;i=i.replace(new RegExp("{data-name}","g"),"/"),i=i.replace(new RegExp("{data-path}","g"),r),e("#begard-breadcrumb").append(i),e.each(d,function(t,d){r+=d;var i=a.options.templates.breadcrumb;i=i.replace(new RegExp("{data-name}","g"),d),i=i.replace(new RegExp("{data-path}","g"),r),e("#begard-breadcrumb").append(i),r+="/"}),e("#begard-breadcrumb .begard-crumb").last().addClass("active")},uploadInputChangeEvent:function(e,t){var d=e.target.files[0];d.percent=0,d.id=++a.lastFileId,a.upload(d)},upload:function(t){a.createUploadItem(t);var d=new FormData;d.append("file",t),d.append("path",a.currentPath),d.append("requestType","upload"),e("#begard-upload-form")[0].reset();e.ajax({url:a.options.remote,method:a.options.method,data:d,cache:!1,dataType:"json",processData:!1,contentType:!1,cache:!1,xhr:function(){var d=e.ajaxSettings.xhr();return d.upload&&d.upload.addEventListener("progress",function(e){var d=0,r=e.loaded||e.position,i=e.total;e.lengthComputable&&(d=Math.ceil(r/i*100)),t.percent=d,a.refreshUploadItem(t)},!1),d}}).done(function(d){if(1!==d.status)a.failedUploadItem(t,d.message);else{var r=e('.begard-upload-item[data-id="'+t.id+'"]');r.addClass("begard-upload-item-succeed"),a.needRefresh(d.path)}}).fail(function(e,d){a.failedUploadItem(t)}).complete(function(){var a=e('.begard-upload-item[data-id="'+t.id+'"]');a.find(".begard-upload-close").removeClass("disabled")})},failedUploadItem:function(t,d){var r=e('.begard-upload-item[data-id="'+t.id+'"]');"undefined"!=typeof d?r.addClass("begard-upload-item-failed").find(".begard-upload-error").text(d).removeClass("disabled"):r.addClass("begard-upload-item-failed").find(".begard-upload-error").text(a.options.defaultErrorMessage).removeClass("disabled")},createUploadItem:function(t){e('.begard-upload-item[data-id="'+t.id+'"]').remove();var d=a.options.templates.uploadList;d=d.replace(new RegExp("{data-id}","g"),t.id),d=d.replace(new RegExp("{data-percent}","g"),t.percent),d=d.replace(new RegExp("{data-name}","g"),t.name),e("#begard-upload-list").append(d)},refreshUploadItem:function(a){var t=e('.begard-upload-item[data-id="'+a.id+'"]');t.find("[data-change-percent-width]").css({width:a.percent+"%"}),t.find("[data-change-percent-text]").text(a.percent+"%")},uploadCloseEvent:function(e,a){a.closest(".begard-upload-item").remove()},renameEvent:function(t,d){a.currentOperation="rename",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-rename").removeClass("disabled");var r=e("#begard-files .begard-selected"),i=e("#begard-directories .begard-selected");if(a.willOperate={requestType:"operation",operation:"rename",extra:e.extend(!0,{},a.options.sendWith.rename,a.options.sendWith.all)},1===r.length){var s=r.attr("data-path");a.willOperate.type="file",a.willOperate.path=s,a.willOperate.name=a.data[s].files[r.attr("data-index")].name}else{var s=i.attr("data-path");a.willOperate.type="directory",a.willOperate.path=s,a.willOperate.name=a.data[s].directories[i.attr("data-index")]}},renameGoEvent:function(t,d){a.willOperate.renameTo=e("#begard-operation-rename-input").val(),e.ajax({url:a.options.remote,data:a.willOperate,method:a.options.method,dataType:"json",cache:!1}).done(function(e){1!==e.status?a.showError(e.message):a.needRefresh(e.path)}).fail(function(){a.showError(a.options.defaultErrorMessage)}).complete(function(){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-rename").addClass("disabled"),a.currentOperation=null})},renameCancelEvent:function(t,d){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-rename").addClass("disabled"),a.currentOperation=null},deleteEvent:function(t,d){a.currentOperation="delete",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-delete").removeClass("disabled");var r=e("#begard-files .begard-selected"),i=e("#begard-directories .begard-selected");a.willOperate={requestType:"operation",operation:"delete",path:a.currentPath,files:[],directories:[],extra:e.extend(!0,{},a.options.sendWith["delete"],a.options.sendWith.all)},r.each(function(){var t=e(this).attr("data-path");a.willOperate.files.push(a.data[t].files[e(this).attr("data-index")].name)}),i.each(function(){var t=e(this).attr("data-path");a.willOperate.directories.push(a.data[t].directories[e(this).attr("data-index")])})},deleteGoEvent:function(t,d){e.ajax({url:a.options.remote,data:a.willOperate,method:a.options.method,dataType:"json",cache:!1}).done(function(e){1!==e.status?a.showError(e.message):a.needRefresh(e.path)}).fail(function(){a.showError(a.options.defaultErrorMessage)}).complete(function(){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-delete").addClass("disabled"),a.currentOperation=null})},deleteCancelEvent:function(t,d){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-delete").addClass("disabled"),a.currentOperation=null},copyEvent:function(t,d){a.currentOperation="copy",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-paste").removeClass("disabled"),e("#begard-operation-paste-go").addClass("disabled").attr("disabled");var r=e("#begard-files .begard-selected"),i=e("#begard-directories .begard-selected");a.willOperate={requestType:"operation",operation:"copy",path:a.currentPath,files:[],directories:[],extra:e.extend(!0,{},a.options.sendWith.copy,a.options.sendWith.all)},r.each(function(){var t=e(this).attr("data-path");a.willOperate.files.push(a.data[t].files[e(this).attr("data-index")].name)}),i.each(function(){var t=e(this).attr("data-path");a.willOperate.directories.push(a.data[t].directories[e(this).attr("data-index")])})},moveEvent:function(t,d){a.currentOperation="move",e("#begard-operations-links").addClass("disabled"),e("#begard-operation-paste").removeClass("disabled"),e("#begard-operation-paste-go").addClass("disabled").attr("disabled");var r=e("#begard-files .begard-selected"),i=e("#begard-directories .begard-selected");a.willOperate={requestType:"operation",operation:"move",path:a.currentPath,files:[],directories:[],extra:e.extend(!0,{},a.options.sendWith.move,a.options.sendWith.all)},r.each(function(){var t=e(this).attr("data-path");a.willOperate.files.push(a.data[t].files[e(this).attr("data-index")].name)}),i.each(function(){var t=e(this).attr("data-path");a.willOperate.directories.push(a.data[t].directories[e(this).attr("data-index")])})},pasteCancelEvent:function(t,d){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-paste").addClass("disabled"),e("#begard-operation-paste-go").removeClass("disabled").removeAttr("disabled"),a.currentOperation=null},pasteGoEvent:function(t,d){a.willOperate.pathTo=a.currentPath,e.ajax({url:a.options.remote,data:a.willOperate,method:a.options.method,dataType:"json",cache:!1}).done(function(e){1!==e.status?a.showError(e.message):(a.needRefresh(e.path),a.needRefresh(e.pathTo))}).fail(function(){a.showError(a.options.defaultErrorMessage)}).complete(function(){e("#begard-operations-links").removeClass("disabled"),e("#begard-operation-paste").addClass("disabled"),a.currentOperation=null})},needRefresh:function(t){delete a.data[t],t===a.currentPath&&(a.options.autoRefresh?a.openDirectory(a.currentPath):e("#begard-need-refresh").attr("data-path",a.currentPath).removeClass("disabled"))},showError:function(a){e("#begard-error").removeClass("disabled"),e("#begard-error-text").text(a)},closeErrorEvent:function(a,t){e("#begard-error").addClass("disabled")},closeBegard:function(){e("#begard").removeClass("begard-modal"),e("#begard-modal-back").addClass("disabled")},selectEvent:function(t,d){if(null!==a.modalEvents.afterSelect){var r,i=null,s=null;r=a.currentPath;var l=e("#begard-files .begard-selected");if(a.options.selectRules.fileSelect)if(a.options.multiSelect)i=[],l.each(function(){var t=e(this).attr("data-path");i.push(a.data[t].files[e(this).attr("data-index")])});else{var r=l.attr("data-path");i=a.data[r].files[l.attr("data-index")]}var n=e("#begard-directories .begard-selected");if(a.options.selectRules.directorySelect)if(a.options.multiSelect)s=[],n.each(function(){var t=e(this).attr("data-path");s.push(a.data[t].directories[e(this).attr("data-index")])});else{var r=n.attr("data-path");s=a.data[r].directories[n.attr("data-index")]}a.modalEvents.afterSelect(r,i,s)}a.closeBegard()}};return begard={init:function(){a.handleEvents()},standalone:function(t){e.extend(!0,a.options,t),a.init(!1),e("#begard-close").addClass("disabled"),e("#begard").addClass("begard-standalone").removeClass("begard-modal"),e("#begard-modal-back").addClass("disabled"),e("#begard-select").addClass("disabled")},modal:function(t,d){e.extend(!0,a.options,t),e.extend(!0,a.modalEvents,d),a.init(!0),e("#begard").addClass("begard-modal").removeClass("begard-standalone"),e("#begard-modal-back").removeClass("disabled"),a.options.selectRules.select?e("#begard-select-link").addClass("disabled").attr("disabled","disabled"):e("#begard-select").addClass("disabled")},close:function(){a.closeBegard()}}},"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):window.begard=e(window.jQuery)}).call(this);